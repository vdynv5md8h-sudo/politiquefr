// Schema Prisma pour PolitiqueFR
// Base de données: PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== ÉLUS - MAIRES ====================

model Maire {
  id                  String   @id @default(cuid())
  rneId               String   @unique // ID du Répertoire National des Élus

  // Informations personnelles
  civilite            String   // "M." ou "Mme"
  prenom              String
  nom                 String
  dateNaissance       DateTime?
  lieuNaissance       String?
  profession          String?

  // Informations sur le mandat
  codeCommune         String
  libelleCommune      String
  codeDepartement     String
  libelleDepartement  String
  codeRegion          String?
  libelleRegion       String?

  dateDebutMandat     DateTime
  dateFinMandat       DateTime?
  fonctionMandat      String   // "Maire", "Maire délégué"

  // Nuance politique
  codeNuance          String?
  libelleNuance       String?

  // Contact
  email               String?
  telephone           String?
  siteWeb             String?

  // Métadonnées
  photoUrl            String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  // Relations
  promesses           Promesse[]

  @@index([codeDepartement])
  @@index([codeCommune])
  @@index([nom, prenom])
  @@index([codeNuance])
}

// ==================== ÉLUS - DÉPUTÉS ====================

model Depute {
  id                      String   @id @default(cuid())
  slug                    String   @unique // Slug nosdeputes.fr (legacy - garder pour migration)
  acteurUid               String?  @unique // UID Assemblée nationale (PA722xxx)

  // Informations personnelles
  civilite                String
  prenom                  String
  nom                     String
  nomUsuel                String?
  dateNaissance           DateTime?
  lieuNaissance           String?
  profession              String?

  // Informations sur le mandat
  legislature             Int
  numeroCirconscription   Int
  departement             String
  codeDepartement         String?
  dateDebutMandat         DateTime
  dateFinMandat           DateTime?
  motifFin                String?  // "Fin de législature", "Démission", etc.
  mandatEnCours           Boolean  @default(true)

  // Groupe politique
  groupeId                String?
  groupe                  GroupePolitique? @relation(fields: [groupeId], references: [id])

  // Statistiques d'activité
  presenceCommission      Float?
  presenceHemicycle       Float?
  participationScrutins   Float?
  questionsEcrites        Int?
  questionsOrales         Int?
  propositionsLoi         Int?
  rapports                Int?
  interventions           Int?
  amendementsProposes     Int?
  amendementsAdoptes      Int?

  // Liens et contact
  email                   String?
  twitter                 String?
  facebook                String?
  siteWeb                 String?
  photoUrl                String?
  urlNosdeputes           String?  // DEPRECATED - garder pour migration
  urlAssemblee            String?
  urlAssembleeNationale   String?  // URL officielle nouvelle structure AN

  // Métadonnées
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  votes                   VoteDepute[]
  promesses               Promesse[]
  questions               Question[]
  commissionsMemb         MembreCommission[]

  @@index([groupeId])
  @@index([departement])
  @@index([codeDepartement])
  @@index([legislature])
  @@index([nom, prenom])
  @@index([mandatEnCours])
}

// ==================== ÉLUS - SÉNATEURS ====================

model Senateur {
  id                    String   @id @default(cuid())
  matricule             String   @unique // Identifiant Sénat

  // Informations personnelles
  civilite              String
  prenom                String
  nom                   String
  dateNaissance         DateTime?
  lieuNaissance         String?
  profession            String?

  // Informations sur le mandat
  departement           String
  codeDepartement       String
  serieSenat            Int      // 1 ou 2
  dateDebutMandat       DateTime
  dateFinMandat         DateTime?
  typeElection          String?  // "Élection", "Remplacement"
  mandatEnCours         Boolean  @default(true)

  // Groupe politique
  groupeId              String?
  groupe                GroupePolitique? @relation(fields: [groupeId], references: [id])

  // Statistiques d'activité
  presenceCommission    Float?
  presenceSeance        Float?
  questionsEcrites      Int?
  questionsOrales       Int?
  propositionsLoi       Int?
  rapports              Int?

  // Liens et contact
  email                 String?
  twitter               String?
  siteWeb               String?
  photoUrl              String?
  urlSenat              String?

  // Métadonnées
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Relations
  votes                 VoteSenateur[]
  promesses             Promesse[]

  @@index([groupeId])
  @@index([codeDepartement])
  @@index([nom, prenom])
  @@index([mandatEnCours])
}

// ==================== GROUPES POLITIQUES ====================

model GroupePolitique {
  id                String   @id @default(cuid())
  acronyme          String
  nom               String
  chambre           Chambre  // ASSEMBLEE ou SENAT

  // Description
  ideologie         String?
  positionPolitique String?  // "Gauche", "Centre-Gauche", "Centre", "Centre-Droit", "Droite"
  description       String?
  couleur           String?  // Couleur hex pour les visualisations

  // Statistiques
  nombreMembres     Int      @default(0)

  // Liens
  siteWeb           String?
  logoUrl           String?

  // Métadonnées
  dateCreation      DateTime?
  actif             Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  deputes           Depute[]
  senateurs         Senateur[]

  @@unique([acronyme, chambre])
  @@index([chambre])
  @@index([actif])
}

enum Chambre {
  ASSEMBLEE
  SENAT
}

// ==================== LOIS ET TEXTES ====================

model Loi {
  id                  String    @id @default(cuid())
  dossierId           String    @unique // ID du dossier législatif

  // Informations de base
  titre               String
  titreOfficiel       String?
  titreCourt          String?
  type                TypeLoi

  // Statut et dates
  statut              StatutLoi
  dateDepot           DateTime
  dateAdoption        DateTime?
  datePromulgation    DateTime?
  numeroJo            String?   // Référence Journal Officiel

  // Contenu
  resume              String?
  exposeDesMotifs     String?
  urlDossier          String?
  urlTexte            String?

  // Auteurs et rapporteurs (JSON)
  auteurs             String?   // JSON array des noms
  rapporteurs         String?   // JSON array des noms

  // Thème
  themeId             String?
  theme               ThemeLoi? @relation(fields: [themeId], references: [id])

  // Métadonnées
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  // Relations
  scrutins            Scrutin[]
  amendements         Amendement[]
  travauxParlementaire TravauxParlementaire?
  resumes             ResumeLLM[]

  @@index([statut])
  @@index([type])
  @@index([dateDepot])
  @@index([themeId])
}

enum TypeLoi {
  PROJET_LOI
  PROPOSITION_LOI
  PROJET_LOI_ORGANIQUE
  PROPOSITION_LOI_ORGANIQUE
  PROJET_LOI_FINANCES
  PROJET_LOI_REGLEMENT
  PROJET_LOI_FINANCEMENT_SECU
  PROPOSITION_RESOLUTION
}

enum StatutLoi {
  DEPOSE
  EN_COMMISSION
  EN_SEANCE
  ADOPTE_PREMIERE_LECTURE
  NAVETTE
  ADOPTE_DEFINITIF
  PROMULGUE
  REJETE
  RETIRE
  CADUQUE
}

model ThemeLoi {
  id    String @id @default(cuid())
  nom   String @unique
  lois  Loi[]
}

// ==================== SCRUTINS ET VOTES ====================

model Scrutin {
  id                String          @id @default(cuid())
  numeroScrutin     Int
  chambre           Chambre
  legislature       Int?

  // Timing
  dateScrutin       DateTime
  seance            String?

  // Sujet
  titre             String
  objet             String?
  loiId             String?
  loi               Loi?            @relation(fields: [loiId], references: [id])

  // Résultats
  nombreVotants     Int
  nombreSuffrages   Int
  majoriteAbsolue   Int
  pour              Int
  contre            Int
  abstention        Int
  resultat          ResultatScrutin

  // Liens
  urlScrutin        String?

  // Métadonnées
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  // Relations
  votesDeputes      VoteDepute[]
  votesSenateurs    VoteSenateur[]

  @@unique([numeroScrutin, chambre, legislature])
  @@index([dateScrutin])
  @@index([loiId])
  @@index([chambre])
}

enum ResultatScrutin {
  ADOPTE
  REJETE
}

model VoteDepute {
  id            String        @id @default(cuid())
  deputeId      String
  depute        Depute        @relation(fields: [deputeId], references: [id], onDelete: Cascade)
  scrutinId     String
  scrutin       Scrutin       @relation(fields: [scrutinId], references: [id], onDelete: Cascade)

  position      PositionVote
  parDelegation Boolean       @default(false)

  createdAt     DateTime      @default(now())

  @@unique([deputeId, scrutinId])
  @@index([scrutinId])
  @@index([position])
}

model VoteSenateur {
  id            String        @id @default(cuid())
  senateurId    String
  senateur      Senateur      @relation(fields: [senateurId], references: [id], onDelete: Cascade)
  scrutinId     String
  scrutin       Scrutin       @relation(fields: [scrutinId], references: [id], onDelete: Cascade)

  position      PositionVote
  parDelegation Boolean       @default(false)

  createdAt     DateTime      @default(now())

  @@unique([senateurId, scrutinId])
  @@index([scrutinId])
  @@index([position])
}

enum PositionVote {
  POUR
  CONTRE
  ABSTENTION
  NON_VOTANT
}

// ==================== AMENDEMENTS ====================

model Amendement {
  id              String          @id @default(cuid())
  uid             String          @unique // UID AN (AMANR5L17XXXX)
  numero          String
  chambre         Chambre
  legislature     Int             @default(17)

  // Lien vers loi OU travaux parlementaire
  loiId           String?
  loi             Loi?            @relation(fields: [loiId], references: [id], onDelete: Cascade)

  travauxId       String?
  travaux         TravauxParlementaire? @relation(fields: [travauxId], references: [id], onDelete: Cascade)

  // Référence au texte (numéro du texte visé)
  texteLegislatifRef String?

  // Contenu
  dispositif      String?         @db.Text
  exposeSommaire  String?         @db.Text

  // Auteur(s) - JSON array avec deputeId, nom, prenom, groupe
  auteurs         String?

  // Statut
  sort            SortAmendement
  dateDepot       DateTime
  dateDiscussion  DateTime?

  // Liens
  urlAmendement   String?

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([loiId])
  @@index([travauxId])
  @@index([dateDepot])
  @@index([sort])
  @@index([legislature])
}

enum SortAmendement {
  ADOPTE
  REJETE
  RETIRE
  TOMBE
  IRRECEVABLE
  NON_SOUTENU
  EN_COURS
}

// ==================== PROMESSES ÉLECTORALES ====================

model Promesse {
  id              String          @id @default(cuid())

  // Qui a fait la promesse
  maireId         String?
  maire           Maire?          @relation(fields: [maireId], references: [id], onDelete: Cascade)
  deputeId        String?
  depute          Depute?         @relation(fields: [deputeId], references: [id], onDelete: Cascade)
  senateurId      String?
  senateur        Senateur?       @relation(fields: [senateurId], references: [id], onDelete: Cascade)

  // Contenu de la promesse
  titre           String
  description     String?
  source          String?         // URL ou référence
  datePromesse    DateTime?

  // Statut
  statut          StatutPromesse  @default(NON_EVALUEE)
  evaluation      String?
  dateEvaluation  DateTime?

  // Métadonnées
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([maireId])
  @@index([deputeId])
  @@index([senateurId])
  @@index([statut])
}

enum StatutPromesse {
  NON_EVALUEE
  EN_COURS
  PARTIELLEMENT_TENUE
  TENUE
  NON_TENUE
  ABANDONNEE
}

// ==================== ACTUALITÉS ====================

model ArticleActualite {
  id              String            @id @default(cuid())

  // Contenu
  titre           String
  contenu         String
  resume          String?

  // Source
  source          String            // Nom du flux RSS
  sourceUrl       String?
  auteur          String?
  guidSource      String?           @unique // GUID du flux RSS pour éviter les doublons

  // Catégorisation
  categorie       CategorieActualite
  tags            String?           // JSON array

  // Modération
  statut          StatutActualite   @default(EN_ATTENTE)
  modereePar      String?
  modereeA        DateTime?
  noteModeration  String?

  // Publication
  datePublication DateTime
  imageUrl        String?

  // Métadonnées
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([categorie])
  @@index([statut])
  @@index([datePublication])
}

enum CategorieActualite {
  POLITIQUE_GENERALE
  ASSEMBLEE
  SENAT
  GOUVERNEMENT
  ELECTIONS
  AFFAIRES_JUDICIAIRES
  CONTROVERSES
  ECONOMIE
  SOCIAL
  INTERNATIONAL
}

enum StatutActualite {
  EN_ATTENTE
  APPROUVE
  REJETE
  ARCHIVE
}

// ==================== AFFAIRES JUDICIAIRES ====================

model AffaireJudiciaire {
  id                String              @id @default(cuid())

  // Informations de base
  titre             String
  description       String

  // Personnes impliquées (JSON array)
  personnes         String
  type              TypeAffaire

  // Timeline
  dateDebut         DateTime
  dateJugement      DateTime?
  statut            StatutAffaire

  // Détails
  juridiction       String?
  reference         String?             // Référence du dossier

  // Dernière actualité
  derniereActualite String?
  dateActualite     DateTime?

  // Sources (JSON array d'URLs)
  sources           String?

  // Métadonnées
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([statut])
  @@index([type])
  @@index([dateDebut])
}

enum TypeAffaire {
  CORRUPTION
  ABUS_DE_CONFIANCE
  DETOURNEMENT_FONDS
  PRISE_ILLEGALE_INTERETS
  EMPLOI_FICTIF
  FRAUDE_FISCALE
  FINANCEMENT_ILLEGAL_CAMPAGNE
  DIFFAMATION
  HARCELEMENT
  AUTRE
}

enum StatutAffaire {
  ENQUETE
  INSTRUCTION
  PROCES
  CONDAMNE
  RELAXE
  APPEL
  CASSATION
  PRESCRIT
  CLASSE_SANS_SUITE
  NON_LIEU
}

// ==================== ADMINISTRATION ====================

model Utilisateur {
  id              String        @id @default(cuid())
  email           String        @unique
  motDePasseHash  String
  nom             String
  role            RoleUtilisateur @default(MODERATEUR)

  actif           Boolean       @default(true)
  derniereConnexion DateTime?

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  journauxAudit   JournalAudit[]
}

enum RoleUtilisateur {
  ADMIN
  MODERATEUR
}

model JournalAudit {
  id              String        @id @default(cuid())
  utilisateurId   String
  utilisateur     Utilisateur   @relation(fields: [utilisateurId], references: [id])

  action          String
  typeEntite      String
  entiteId        String?
  details         String?       // JSON
  adresseIp       String?

  createdAt       DateTime      @default(now())

  @@index([utilisateurId])
  @@index([typeEntite, entiteId])
  @@index([createdAt])
}

// ==================== QUESTIONS PARLEMENTAIRES ====================

model Question {
  id                String        @id @default(cuid())
  uid               String        @unique // Ex: QANR5L16QE83

  // Type et identifiant
  type              TypeQuestion
  numero            Int
  legislature       Int

  // Auteur
  acteurRef         String        // ID Assemblée nationale (PA...)
  deputeId          String?
  depute            Depute?       @relation(fields: [deputeId], references: [id], onDelete: SetNull)
  groupeAcronyme    String?
  groupeNom         String?

  // Contenu
  rubrique          String?       // Thème (ex: "professions de santé")
  analyse           String?       // Résumé court
  texteQuestion     String        @db.Text
  texteReponse      String?       @db.Text

  // Ministère
  ministereAcronyme String?
  ministereDeveloppe String?

  // Dates
  dateQuestion      DateTime
  dateReponse       DateTime?

  // Statut
  statut            String?       // REP_PUB, RETRAIT, etc.

  // Métadonnées
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@index([deputeId])
  @@index([acteurRef])
  @@index([type])
  @@index([dateQuestion])
  @@index([rubrique])
}

enum TypeQuestion {
  QE    // Question écrite
  QG    // Question au Gouvernement
  QOSD  // Question orale sans débat
}

// ==================== SYNCHRONISATION DES DONNÉES ====================

model JournalSync {
  id                  String      @id @default(cuid())
  typeDonnees         String      // "maires", "deputes", "senateurs", "lois", "actualites"
  statut              StatutSync

  debuteA             DateTime
  termineA            DateTime?

  enregistrementsTraites  Int     @default(0)
  enregistrementsCrees    Int     @default(0)
  enregistrementsMisAJour Int     @default(0)
  enregistrementsErreurs  Int     @default(0)

  messageErreur       String?

  @@index([typeDonnees])
  @@index([debuteA])
  @@index([statut])
}

enum StatutSync {
  EN_COURS
  TERMINE
  ECHEC
}

// ==================== TRAVAUX PARLEMENTAIRES ====================

model TravauxParlementaire {
  id                    String                @id @default(cuid())
  uid                   String                @unique // UID AN (DLR5L17XXXX)

  // Type de travail
  typeDocument          TypeDocumentParlement

  // Informations de base
  titre                 String
  titreOfficiel         String?
  titreCourt            String?

  // Legislature et dates
  legislature           Int
  dateDepot             DateTime
  dateExamen            DateTime?
  dateAdoption          DateTime?
  datePromulgation      DateTime?

  // Chambre d'origine
  chambreOrigine        Chambre

  // Statut
  statutExamen          StatutExamenTravaux   @default(EN_ATTENTE)

  // Contenu
  exposeSommaire        String?               @db.Text
  urlDocumentPdf        String?
  urlDossierAN          String?
  urlDossierSenat       String?

  // Auteurs (JSON array)
  auteurs               String?               // JSON array of { acteurRef, nom, prenom, groupeId }

  // Commission référente
  commissionId          String?
  commission            CommissionParlementaire? @relation(fields: [commissionId], references: [id])

  // Theme/Indexation
  themeId               String?
  theme                 ThemeTravaux?         @relation(fields: [themeId], references: [id])
  rubriques             String?               // JSON array of keywords

  // Lien vers modèle Loi existant (si applicable)
  loiId                 String?               @unique
  loi                   Loi?                  @relation(fields: [loiId], references: [id])

  // Relations
  resumes               ResumeLLM[]
  indicateurs           IndicateurStatistique[]
  amendements           Amendement[]

  // Metadata
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  @@index([typeDocument])
  @@index([legislature])
  @@index([statutExamen])
  @@index([dateDepot])
  @@index([themeId])
  @@index([commissionId])
}

enum TypeDocumentParlement {
  PROJET_LOI
  PROPOSITION_LOI
  PROJET_LOI_ORGANIQUE
  PROPOSITION_LOI_ORGANIQUE
  PROJET_LOI_FINANCES
  PROJET_LOI_REGLEMENT
  PROJET_LOI_FINANCEMENT_SECU
  PROPOSITION_RESOLUTION
  TEXTE_ADOPTE
  RAPPORT
  RAPPORT_INFORMATION
  AVIS
  COMPTE_RENDU
}

enum StatutExamenTravaux {
  EN_ATTENTE
  EN_COMMISSION
  EN_SEANCE
  PREMIERE_LECTURE_AN
  PREMIERE_LECTURE_SENAT
  DEUXIEME_LECTURE
  CMP
  LECTURE_DEFINITIVE
  ADOPTE
  PROMULGUE
  REJETE
  RETIRE
  CADUQUE
}

// ==================== COMMISSIONS PARLEMENTAIRES ====================

model CommissionParlementaire {
  id                    String                @id @default(cuid())
  uid                   String                @unique // UID from AN

  nom                   String
  nomCourt              String?
  typeCommission        TypeCommission
  chambre               Chambre
  legislature           Int

  // Dates d'activité
  dateDebut             DateTime?
  dateFin               DateTime?
  actif                 Boolean               @default(true)

  // Bureau
  presidentId           String?
  vicePresidents        String?               // JSON array
  secretaires           String?               // JSON array

  urlCommission         String?

  // Relations
  travaux               TravauxParlementaire[]
  commissionsEnquete    CommissionEnquete[]
  membres               MembreCommission[]

  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  @@index([typeCommission])
  @@index([chambre])
  @@index([legislature])
}

enum TypeCommission {
  PERMANENTE
  SPECIALE
  ENQUETE
  AD_HOC
  MIXTE_PARITAIRE
}

enum RoleCommission {
  PRESIDENT
  VICE_PRESIDENT
  SECRETAIRE
  MEMBRE
}

// ==================== MEMBRES DES COMMISSIONS ====================

model MembreCommission {
  id              String                    @id @default(cuid())

  // Relation vers le député
  deputeId        String
  depute          Depute                    @relation(fields: [deputeId], references: [id], onDelete: Cascade)

  // Relation vers la commission
  commissionId    String
  commission      CommissionParlementaire   @relation(fields: [commissionId], references: [id], onDelete: Cascade)

  // Rôle et période
  role            RoleCommission            @default(MEMBRE)
  dateDebut       DateTime?
  dateFin         DateTime?
  actif           Boolean                   @default(true)

  createdAt       DateTime                  @default(now())

  @@unique([deputeId, commissionId])
  @@index([commissionId])
  @@index([deputeId])
  @@index([actif])
}

// ==================== COMMISSIONS D'ENQUÊTE ====================

model CommissionEnquete {
  id                    String                    @id @default(cuid())
  uid                   String                    @unique

  titre                 String
  sujet                 String                    @db.Text

  // Contexte
  legislature           Int
  chambre               Chambre

  // Dates
  dateCreation          DateTime
  dateFin               DateTime?
  dureeInitialeMois     Int                       @default(6)
  prolongations         Int                       @default(0)

  // Composition
  presidentNom          String?
  rapporteurNom         String?
  nombreMembres         Int?

  // Commission mère (si applicable)
  commissionId          String?
  commission            CommissionParlementaire?  @relation(fields: [commissionId], references: [id])

  // Statut
  statut                StatutCommissionEnquete   @default(EN_COURS)

  // Documents
  urlRapportFinal       String?
  urlVideos             String?
  urlCompteRendus       String?

  // Résumés
  resumes               ResumeLLM[]

  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  @@index([legislature])
  @@index([chambre])
  @@index([statut])
}

enum StatutCommissionEnquete {
  EN_COURS
  TERMINE
  RAPPORT_DEPOSE
  ARCHIVE
}

// ==================== RÉSUMÉS LLM ====================

model ResumeLLM {
  id                    String                @id @default(cuid())

  // Relations polymorphiques
  travauxId             String?
  travaux               TravauxParlementaire? @relation(fields: [travauxId], references: [id], onDelete: Cascade)
  commissionEnqueteId   String?
  commissionEnquete     CommissionEnquete?    @relation(fields: [commissionEnqueteId], references: [id], onDelete: Cascade)
  loiId                 String?
  loi                   Loi?                  @relation(fields: [loiId], references: [id], onDelete: Cascade)

  // Contenu
  typeResume            TypeResume
  contenu               String                @db.Text

  // LLM Metadata
  modeleLLM             String                // "claude-3-5-sonnet", etc.
  versionPrompt         String                @default("1.0")
  tokensEntree          Int?
  tokensSortie          Int?

  // Quality
  score                 Float?                // Optional quality score
  estValide             Boolean               @default(true)

  // Caching
  hashSource            String?               // Hash of source content for cache invalidation

  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  @@index([travauxId])
  @@index([commissionEnqueteId])
  @@index([loiId])
  @@index([typeResume])
  @@unique([travauxId, typeResume])
  @@unique([commissionEnqueteId, typeResume])
  @@unique([loiId, typeResume])
}

enum TypeResume {
  COURT           // 2-3 phrases
  MOYEN           // 1 paragraphe
  LONG            // Plusieurs paragraphes
  POINTS_CLES     // Liste de points clés
  VULGARISE       // Version grand public
}

// ==================== THÈMES DES TRAVAUX ====================

model ThemeTravaux {
  id                    String                    @id @default(cuid())

  // Identification
  code                  String                    @unique // "ECO", "SOC", "ENV", etc.
  nom                   String
  description           String?
  couleur               String?                   // Hex color
  icone                 String?                   // Icon name

  // Hiérarchie
  parentId              String?
  parent                ThemeTravaux?             @relation("ThemeHierarchy", fields: [parentId], references: [id])
  enfants               ThemeTravaux[]            @relation("ThemeHierarchy")

  // Mots-clés pour matching automatique
  motsCles              String?                   // JSON array

  // Relations
  travaux               TravauxParlementaire[]
  indicateurs           IndicateurStatistique[]

  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  @@index([parentId])
  @@index([code])
}

// ==================== INDICATEURS STATISTIQUES (INSEE) ====================

model IndicateurStatistique {
  id                    String                    @id @default(cuid())

  // Identification
  codeInsee             String?                   // Code série Insee
  codeDataGouv          String?                   // Dataset ID on data.gouv.fr
  nom                   String
  description           String?

  // Valeur actuelle
  valeurActuelle        Float?
  dateValeur            DateTime?
  unite                 String?                   // "%", "M€", "milliers", etc.

  // Tendance
  variationAnnuelle     Float?
  variationMensuelle    Float?

  // Thème
  themeId               String?
  theme                 ThemeTravaux?             @relation(fields: [themeId], references: [id])

  // URL source
  urlSource             String?
  urlApiInsee           String?

  // Liens vers travaux
  travauxId             String?
  travaux               TravauxParlementaire?     @relation(fields: [travauxId], references: [id])

  // Cache
  derniereMiseAJour     DateTime?

  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  @@index([themeId])
  @@index([travauxId])
  @@index([codeInsee])
}

// ==================== SÉANCES PUBLIQUES ET COMPTES RENDUS ====================

model SeancePublique {
  id                    String                @id @default(cuid())
  uid                   String                @unique // CRSANR5L17S2025O1N001

  // Références
  seanceRef             String?               // RUANR5L17S2025IDS28577
  sessionRef            String?               // SCR5A2025O1

  // Métadonnées
  legislature           Int
  session               String?               // "Session ordinaire 2024-2025"
  numSeance             Int?                  // Numéro de séance
  numSeanceJour         String?               // "Unique", "1ère", "2e"

  // Date et heure
  dateSeance            DateTime
  dateSeanceStr         String?               // "mardi 01 octobre 2024"

  // Contenu
  sommaire              String?               @db.Text    // JSON summary with titles and speakers
  orateurs              String?               @db.Text    // JSON array of speakers with id and name

  // Statistiques
  nombreInterventions   Int?
  nombreOrateurs        Int?
  dureeMinutes          Int?

  // État
  etat                  String?               // "complet", "partiel"
  validite              String?               // "valide"
  diffusion             String?               // "public"

  // Liens
  urlCompteRendu        String?

  // Relations
  interventions         Intervention[]

  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  @@index([legislature])
  @@index([dateSeance])
  @@index([session])
}

model Intervention {
  id                    String                @id @default(cuid())

  // Référence à la séance
  seanceId              String
  seance                SeancePublique        @relation(fields: [seanceId], references: [id], onDelete: Cascade)

  // Référence à l'orateur
  acteurRef             String?               // PA722xxx
  deputeId              String?
  orateur               String                // "Mme Marine Le Pen", "M. Michel Barnier"
  qualite               String?               // "Premier ministre", "RN"
  roleDebat             String?               // "president", "orateur"

  // Contenu
  texte                 String                @db.Text
  pointOdj              String?               // Point de l'ordre du jour
  titrePoint            String?               // "Déclaration du Gouvernement"

  // Ordre
  ordreAbsolu           Int?
  stime                 Float?                // Timestamp in seconds

  // Type
  typeIntervention      String?               // "PAROLE_GENERIQUE", "INTERRUPTION"

  createdAt             DateTime              @default(now())

  @@index([seanceId])
  @@index([acteurRef])
  @@index([deputeId])
}
